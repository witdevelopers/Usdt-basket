<div class="tree-node-wrapper">

  <div class="node" (click)="toggleNodeDetails(node?.member?.memId)" title="Toggle User Details">
    <img src="assets/binary-tree/green.png" alt="Node Image" class="node-image" />

    <div class="node-info-wrapper">
      <div class="node-info">
        {{ formatUserId(node?.member?.userID) }}
      </div>

      <div class="full-details" *ngIf="isExpanded(node?.member?.memId)">
        <div class="table-responsive" *ngIf="node?.member?.memIdDetails">
          <table class="details-table">
            <thead>
              <tr>
                <th>MemID</th>
                <th>User ID</th>
                <th>Sponsor</th>
                <th>Status</th>
                <th>Time</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngIf="node?.member?.memIdDetails as details">
                <ng-container [ngTemplateOutlet]="detailsRow"
                  [ngTemplateOutletContext]="{ row: parseMemIdDetailsStr(details) }"></ng-container>
              </tr>
            </tbody>
          </table>
        </div>
        <div *ngIf="!node?.member?.memIdDetails">No details available</div>
      </div>
    </div>
  </div>

  <ng-template #detailsRow let-row="row">
    <td>{{ row.memid }}</td>
    <td>{{ row.userID }}</td>
    <td>{{ row.sponsor }}</td>
    <td>{{ row.status }}</td>
    <td>{{ row.time }}</td>
  </ng-template>

  <!-- <div class="dual">
    <div class="node" *ngIf="recLmidDetails.length > 0" (click)="toggleUserDetails()" title="Toggle Rec Lmid Details">
      <img src="assets/binary-tree/green.png" alt="Node Image" class="node-image" />
      <div class="node-info">
        {{ recLmidDetails[0]?.userID.slice(0, 6) + '...' + recLmidDetails[0]?.userID.slice(-7) }}
      </div>
    </div>
    <div class="node" *ngIf="recRmidDetails.length > 0" (click)="toggleUserDetails()" title="Toggle Rec Rmid Details">
      <img src="assets/binary-tree/green.png" alt="Node Image" class="node-image" />
      <div class="node-info">
        {{ recRmidDetails[0]?.userID.slice(0, 6) + '...' + recRmidDetails[0]?.userID.slice(-7) }}
      </div>
    </div>
  </div> -->

  <!-- Render Children Recursively -->
  <table width="100%">
    <tr>
      <td class="child-wrapper">
        <ng-container *ngIf="node?.left">
          <app-tree-node [node]="node.left"></app-tree-node>
        </ng-container>
        <!-- <ng-template #addLeft>
          <div
            *ngIf="!recLmidDetails.length"
            class="add-new-user"
            (click)="onAddUser('left')"
            title="Add User to Left"
          >
            <img src="assets/binary-tree/newPerson.jpg" style="width: 50px" />
            <strong>Add User</strong>
          </div>
        </ng-template> -->
      </td>

      <td class="child-wrapper">
        <ng-container *ngIf="node?.right">
          <app-tree-node [node]="node.right"></app-tree-node>
        </ng-container>
        <!-- <ng-template #addRight>
          <div
            *ngIf="!recRmidDetails.length"
            class="add-new-user"
            (click)="onAddUser('right')"
            title="Add User to Right"
          >
            <img src="assets/binary-tree/newPerson.jpg" style="width: 50px" />
            <strong>Add User</strong>
          </div>
        </ng-template> -->
      </td>
    </tr>
  </table>
</div>